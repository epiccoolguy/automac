# Configure bash

- name: Get brew binary prefix
  ansible.builtin.command: brew --prefix
  register: brew_prefix
  changed_when: brew_prefix.rc != 0

- name: Allow bash as login shell
  ansible.builtin.command: grep -qxF "{{ brew_prefix.stdout }}/bin/bash" /etc/shells || echo "{{ brew_prefix.stdout }}/bin/bash" >> /etc/shells
  vars:
    ansible_become: true
    ansible_become_password: "{{ password }}"
  register: allowed
  changed_when: allowed.rc != 0

- name: Set bash as login shell
  ansible.builtin.user:
    name: "{{ ansible_env.USER }}"
    shell: "{{ brew_prefix.stdout }}/bin/bash"
  vars:
    ansible_become: true
    ansible_become_password: "{{ password }}"
